#Necessary libraries for the chatbot to run
import random
import tkinter as tk
import re
import json
from fuzzywuzzy import process, fuzz

#Define a dictionary of possible user inputs and corresponding bot responses
with open("Responses.json", 'r') as r:
    Responses = json.load(r)

#Define a dictionary of possible bot responses if he does not find a good match
with open('idkResponses.txt') as idk:
    idkResponses = idk.readlines()

#Count frequency of words in user input, and train the bot
def train(input_text):
    words = re.findall(r'\w+', input_text.lower())
    return {word: words.count(word) for word in words}

#Find best response using the fuzzy library string matching
def CreateResponse(input):
    #Convert input to lowercase
    input = input.lower()

    #Find a match by iterating through the input and the patterns and get a ratio to decide which output is best
    for input_key in Responses:
        for pattern in Responses[input_key]["patterns"]:
            if process.extractOne(input, [pattern], scorer = fuzz.ratio)[1] >= 75:
                return random.choice(Responses[input_key]["responses"])
            
    #Return a idk response
    return random.choice(idkResponses)

#Create the GUI and link it to the chatbot
GUI = tk.Tk()
GUI.title("Wall-E")
GUI.geometry("600x600")
GUI.configure(bg = "black")

#Output window with scroll bar
outBorder = tk.Frame(GUI)
outBorder.pack(pady = 10)
outBorder.configure(bg = "#444444")

outWindow = tk.Text(outBorder, height = 20, width = 60)
outWindow.pack(side = tk.LEFT)
outWindow.configure(bg = "#444444", fg = "white")

scrlOut = tk.Scrollbar(outBorder, command = outWindow.yview)
scrlOut.pack(side = tk.RIGHT, fill = tk.Y)

outWindow.config(yscrollcommand = scrlOut.set)

#Input box
inBox = tk.Entry(GUI, width = 60)
inBox.pack(pady = 10)
inBox.configure(bg = "white", fg = "black")
inBox.focus_set()

#Send button
def send_message(event = None):
    input = inBox.get()
    if input.lower() == "quit":
        GUI.quit()
    vInput = train(input)
    walleResp = CreateResponse(input)
    outWindow.insert(tk.END, "You: " + input + "\n", "user")
    outWindow.insert(tk.END, "Wall-E: " + walleResp + "\n\n", "bot")
    outWindow.tag_config("user", foreground = "white")
    outWindow.tag_config("bot", foreground = "orange")
    inBox.delete(0, tk.END)

btnSend = tk.Button(GUI, text = "Send", command = send_message, bg = "orange", fg = "black", font = ("Arial", 14, "bold"))
btnSend.pack(pady = 10)
GUI.bind("<Return>", send_message)

#Run the GUI
GUI.mainloop()
